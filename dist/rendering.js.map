{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","data","panel","find","events","on","render","noDataPoints","html","addTopology","s","sigma","graph","renderer","container","document","getElementById","type","settings","doubleClickEnabled","edgeLabelSize","enableEdgeHovering","edgeHoverColor","defaultEdgeHoverColor","edgeHoverSizeRatio","edgeHoverExtremities","minEdgeSize","minNodeSize","draggable","plugins","dragNodes","renderers","filterMode","bind","e","variableSrv","$injector","get","setAdhocFilter","datasource","key","srcNode","value","node","id","operator","edge","source","dstNode","target","trackable","startForceAtlas2","worker","barnesHutOptimize","linLogMode","strongGravityMode","setTimeout","killForceAtlas2","incrementRenderCounter","length","renderingCompleted","_","$"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.pie';\n\nimport './lib/sigma/src/sigma.core';\nimport './lib/sigma/src/conrad';\nimport './lib/sigma/src/utils/sigma.utils';\nimport './lib/sigma/src/utils/sigma.polyfills';\nimport './lib/sigma/src/sigma.settings';\nimport './lib/sigma/src/classes/sigma.classes.dispatcher';\nimport './lib/sigma/src/classes/sigma.classes.configurable';\nimport './lib/sigma/src/classes/sigma.classes.graph';\nimport './lib/sigma/src/classes/sigma.classes.camera';\nimport './lib/sigma/src/classes/sigma.classes.quad';\nimport './lib/sigma/src/captors/sigma.captors.mouse';\nimport './lib/sigma/src/captors/sigma.captors.touch';\nimport './lib/sigma/src/renderers/sigma.renderers.canvas';\nimport './lib/sigma/src/renderers/sigma.renderers.webgl';\nimport './lib/sigma/src/renderers/sigma.renderers.svg';\nimport './lib/sigma/src/renderers/sigma.renderers.def';\nimport './lib/sigma/src/renderers/webgl/sigma.webgl.nodes.def';\nimport './lib/sigma/src/renderers/webgl/sigma.webgl.nodes.fast';\nimport './lib/sigma/src/renderers/webgl/sigma.webgl.edges.def';\nimport './lib/sigma/src/renderers/webgl/sigma.webgl.edges.fast';\nimport './lib/sigma/src/renderers/webgl/sigma.webgl.edges.arrow';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.labels.def';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.hovers.def';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.nodes.def';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edges.def';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edges.curve';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edges.arrow';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edges.curvedArrow';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edgehovers.def';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edgehovers.curve';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edgehovers.arrow';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.extremities.def';\nimport './lib/sigma/src/renderers/svg/sigma.svg.utils';\nimport './lib/sigma/src/renderers/svg/sigma.svg.nodes.def';\nimport './lib/sigma/src/renderers/svg/sigma.svg.edges.def';\nimport './lib/sigma/src/renderers/svg/sigma.svg.edges.curve';\nimport './lib/sigma/src/renderers/svg/sigma.svg.edges.curvedArrow';\nimport './lib/sigma/src/renderers/svg/sigma.svg.labels.def';\nimport './lib/sigma/src/renderers/svg/sigma.svg.hovers.def';\nimport './lib/sigma/src/middlewares/sigma.middlewares.rescale';\nimport './lib/sigma/src/middlewares/sigma.middlewares.copy';\nimport './lib/sigma/src/misc/sigma.misc.animation';\nimport './lib/sigma/src/misc/sigma.misc.bindEvents';\nimport './lib/sigma/src/misc/sigma.misc.bindDOMEvents';\nimport './lib/sigma/src/misc/sigma.misc.drawHovers';\n\nimport './lib/sigma/plugins/sigma.helpers.graph/sigma.helpers.graph';\nimport './lib/sigma/plugins/sigma.renderers.edgeLabels/settings';\nimport './lib/sigma/plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.def';\nimport './lib/sigma/plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.curve';\nimport './lib/sigma/plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.curvedArrow';\n\nimport './lib/sigma/plugins/sigma.plugins.dragNodes/sigma.plugins.dragNodes';\nimport './lib/sigma/plugins/sigma.layouts.forceAtlas2/supervisor';\nimport './lib/sigma/plugins/sigma.layouts.forceAtlas2/worker';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data = ctrl.data, panel = ctrl.panel;\n  elem = elem.find('.topology-panel__chart');\n\n  ctrl.events.on('render', function () {\n    render(false);\n    /*\n    if (panel) {\n      setTimeout(function () { render(true); }, 50);\n    }\n    */\n  });\n\n  function noDataPoints() {\n    var html = '<div class=\"datapoints-warning\"><span class=\"small\">No data points</span></div>';\n    elem.html(html);\n  }\n\n  function addTopology() {\n    elem.html('');\n\n    var s = new sigma({\n      graph: ctrl.panel.graph,\n      renderer: {\n        container: document.getElementById('topology-panel-chart'),\n        type: 'canvas',\n      },\n      settings: {\n        doubleClickEnabled: false,\n        edgeLabelSize: ctrl.panel.edgeLabelSize,\n        enableEdgeHovering: true,\n        edgeHoverColor: 'edge',\n        defaultEdgeHoverColor: '#000',\n        edgeHoverSizeRatio: 1,\n        edgeHoverExtremities: true,\n        minEdgeSize: ctrl.panel.minEdgeSize,\n        minNodeSize: ctrl.panel.minNodeSize,\n      }\n    });\n    if (ctrl.panel.draggable) {\n      sigma.plugins.dragNodes(s, s.renderers[0])\n    }\n    if (ctrl.panel.filterMode === 'nodes' || ctrl.panel.filterMode === 'both') {\n      s.bind('doubleClickNode', function(e) {\n        var variableSrv = ctrl.$injector.get('variableSrv');\n        variableSrv.setAdhocFilter({\n          datasource: ctrl.panel.datasource,\n          key: ctrl.panel.srcNode,\n          value: e.data.node.id,\n          operator: '=',\n        });\n      });\n    }\n    if (ctrl.panel.filterMode === 'edges' || ctrl.panel.filterMode === 'both') {\n      s.bind('doubleClickEdge', function(e) {\n        var variableSrv = ctrl.$injector.get('variableSrv');\n        variableSrv.setAdhocFilter({\n          datasource: ctrl.panel.datasource,\n          key: ctrl.panel.srcNode,\n          value: e.data.edge.source,\n          operator: '=',\n        });\n        variableSrv.setAdhocFilter({\n          datasource: ctrl.panel.datasource,\n          key: ctrl.panel.dstNode,\n          value: e.data.edge.target,\n          operator: '=',\n        });\n      });\n    }\n    if (ctrl.panel.trackable) {\n      s.startForceAtlas2({worker: true, barnesHutOptimize: true, linLogMode: true, strongGravityMode: true});\n      setTimeout(function() { s.killForceAtlas2(); }, 1000);\n    }\n  }\n\n  function render(incrementRenderCounter) {\n    if (!ctrl.data) { return; }\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (0 == ctrl.data.length) {\n      noDataPoints();\n    } else {\n      addTopology();\n    }\n\n    if (incrementRenderCounter) {\n      ctrl.renderingCompleted();\n    }\n  }\n}\n\n"]}