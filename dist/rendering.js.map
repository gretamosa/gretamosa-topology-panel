{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","data","panel","find","events","on","render","noDataPoints","html","addTopology","s","sigma","graph","renderer","container","document","getElementById","type","settings","doubleClickEnabled","edgeLabelSize","enableEdgeHovering","edgeHoverColor","defaultEdgeHoverColor","edgeHoverSizeRatio","edgeHoverExtremities","minEdgeSize","minNodeSize","draggable","plugins","dragNodes","renderers","filterMode","bind","e","variableSrv","$injector","get","setAdhocFilter","datasource","key","srcNode","value","node","id","operator","edge","source","dstNode","target","trackable","startForceAtlas2","worker","barnesHutOptimize","linLogMode","strongGravityMode","setTimeout","killForceAtlas2","incrementRenderCounter","length","renderingCompleted","_","$"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.pie';\n\nimport './lib/sigma/src/sigma.core';\nimport './lib/sigma/src/conrad';\nimport './lib/sigma/src/utils/sigma.utils';\nimport './lib/sigma/src/utils/sigma.polyfills';\nimport './lib/sigma/src/sigma.settings';\nimport './lib/sigma/src/classes/sigma.classes.dispatcher';\nimport './lib/sigma/src/classes/sigma.classes.configurable';\nimport './lib/sigma/src/classes/sigma.classes.graph';\nimport './lib/sigma/src/classes/sigma.classes.camera';\nimport './lib/sigma/src/classes/sigma.classes.quad';\nimport './lib/sigma/src/captors/sigma.captors.mouse';\nimport './lib/sigma/src/captors/sigma.captors.touch';\nimport './lib/sigma/src/renderers/sigma.renderers.canvas';\nimport './lib/sigma/src/renderers/sigma.renderers.webgl';\nimport './lib/sigma/src/renderers/sigma.renderers.svg';\nimport './lib/sigma/src/renderers/sigma.renderers.def';\nimport './lib/sigma/src/renderers/webgl/sigma.webgl.nodes.def';\nimport './lib/sigma/src/renderers/webgl/sigma.webgl.nodes.fast';\nimport './lib/sigma/src/renderers/webgl/sigma.webgl.edges.def';\nimport './lib/sigma/src/renderers/webgl/sigma.webgl.edges.fast';\nimport './lib/sigma/src/renderers/webgl/sigma.webgl.edges.arrow';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.labels.def';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.hovers.def';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.nodes.def';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edges.def';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edges.curve';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edges.arrow';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edges.curvedArrow';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edgehovers.def';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edgehovers.curve';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edgehovers.arrow';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow';\nimport './lib/sigma/src/renderers/canvas/sigma.canvas.extremities.def';\nimport './lib/sigma/src/renderers/svg/sigma.svg.utils';\nimport './lib/sigma/src/renderers/svg/sigma.svg.nodes.def';\nimport './lib/sigma/src/renderers/svg/sigma.svg.edges.def';\nimport './lib/sigma/src/renderers/svg/sigma.svg.edges.curve';\nimport './lib/sigma/src/renderers/svg/sigma.svg.edges.curvedArrow';\nimport './lib/sigma/src/renderers/svg/sigma.svg.labels.def';\nimport './lib/sigma/src/renderers/svg/sigma.svg.hovers.def';\nimport './lib/sigma/src/middlewares/sigma.middlewares.rescale';\nimport './lib/sigma/src/middlewares/sigma.middlewares.copy';\nimport './lib/sigma/src/misc/sigma.misc.animation';\nimport './lib/sigma/src/misc/sigma.misc.bindEvents';\nimport './lib/sigma/src/misc/sigma.misc.bindDOMEvents';\nimport './lib/sigma/src/misc/sigma.misc.drawHovers';\n\nimport './lib/sigma/plugins/sigma.helpers.graph/sigma.helpers.graph';\nimport './lib/sigma/plugins/sigma.renderers.edgeLabels/settings';\nimport './lib/sigma/plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.def';\nimport './lib/sigma/plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.curve';\nimport './lib/sigma/plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.curvedArrow';\n\nimport './lib/sigma/plugins/sigma.plugins.dragNodes/sigma.plugins.dragNodes';\nimport './lib/sigma/plugins/sigma.layouts.forceAtlas2/supervisor';\nimport './lib/sigma/plugins/sigma.layouts.forceAtlas2/worker';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data = ctrl.data, panel = ctrl.panel;\n  elem = elem.find('.topology-panel__chart');\n\n  ctrl.events.on('render', function () {\n    render(false);\n    /*\n    if (panel) {\n      setTimeout(function () { render(true); }, 50);\n    }\n    */\n  });\n\n  function noDataPoints() {\n    var html = '<div class=\"datapoints-warning\"><span class=\"small\">No data points</span></div>';\n    elem.html(html);\n  }\n\n  function addTopology() {\n    elem.html('');\n\n    var s = new sigma({\n      graph: ctrl.panel.graph,\n      renderer: {\n        container: document.getElementById('topology-panel-chart'),\n        type: 'canvas',\n      },\n      settings: {\n        doubleClickEnabled: false,\n        edgeLabelSize: ctrl.panel.edgeLabelSize,\n        enableEdgeHovering: true,\n        edgeHoverColor: 'edge',\n        defaultEdgeHoverColor: '#000',\n        edgeHoverSizeRatio: 1,\n        edgeHoverExtremities: true,\n        minEdgeSize: ctrl.panel.minEdgeSize,\n        minNodeSize: ctrl.panel.minNodeSize,\n      }\n    });\n    if (ctrl.panel.draggable) {\n      sigma.plugins.dragNodes(s, s.renderers[0])\n    }\n    if (ctrl.panel.filterMode === 'nodes' || ctrl.panel.filterMode === 'both') {\n      s.bind('doubleClickNode', function(e) {\n        var variableSrv = ctrl.$injector.get('variableSrv');\n        variableSrv.setAdhocFilter({\n          datasource: ctrl.panel.datasource,\n          key: ctrl.panel.srcNode,\n          value: e.data.node.id,\n          operator: '=',\n        });\n      });\n    }\n    if (ctrl.panel.filterMode === 'edges' || ctrl.panel.filterMode === 'both') {\n      s.bind('doubleClickEdge', function(e) {\n        var variableSrv = ctrl.$injector.get('variableSrv');\n        variableSrv.setAdhocFilter({\n          datasource: ctrl.panel.datasource,\n          key: ctrl.panel.srcNode,\n          value: e.data.edge.source,\n          operator: '=',\n        });\n        variableSrv.setAdhocFilter({\n          datasource: ctrl.panel.datasource,\n          key: ctrl.panel.dstNode,\n          value: e.data.edge.target,\n          operator: '=',\n        });\n      });\n    }\n    if (ctrl.panel.trackable) {\n      s.startForceAtlas2({worker: true, barnesHutOptimize: true, linLogMode: true, strongGravityMode: true});\n      setTimeout(function() { s.killForceAtlas2(); }, 1000);\n    }\n  }\n\n  function render(incrementRenderCounter) {\n    if (!ctrl.data) { return; }\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (0 == ctrl.data.length) {\n      noDataPoints();\n    } else {\n      addTopology();\n    }\n\n    if (incrementRenderCounter) {\n      ctrl.renderingCompleted();\n    }\n  }\n}\n\n"],"file":"rendering.js"}